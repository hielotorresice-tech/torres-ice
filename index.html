<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Torres Ice - Venta de Hielo</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#00aaff">

<style>
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:url("fondo-hielo.png") center/cover no-repeat fixed;
}

.app{
  max-width:420px;
  margin:auto;
  min-height:100vh;
  background:rgba(255,255,255,0.78);
  backdrop-filter:blur(4px);
  padding:16px;
}

header{
  text-align:center;
  margin-bottom:14px;
}

header img{
  width:90px;
  margin-bottom:6px;
}

header h1{
  margin:4px 0;
  font-size:20px;
}

header small{
  display:block;
  font-size:13px;
}

.card{
  background:rgba(255,255,255,0.9);
  border-radius:16px;
  padding:16px;
  text-align:center;
}

h2,h3,p{
  margin:6px 0;
}

.qty{
  display:flex;
  justify-content:center;
  align-items:center;
  gap:12px;
  margin:12px 0;
}

.qty button{
  width:36px;
  height:36px;
  font-size:20px;
}

.qty input{
  width:60px;
  text-align:center;
}

input, select{
  width:100%;
  padding:10px;
  margin-top:8px;
  border-radius:8px;
  border:1px solid #ccc;
}

.summary{
  margin-top:14px;
  text-align:center;
}

.summary p{
  margin:4px 0;
}

.btn{
  width:100%;
  padding:14px;
  border:none;
  border-radius:12px;
  font-size:16px;
  margin-top:10px;
  cursor:pointer;
}

.mp{
  background:#FFD400;
  color:#0056A3;
  font-weight:bold;
}

.tr{
  background:#0072CE;
  color:#fff;
}

.wa{
  background:#25D366;
  color:#003366;
  font-weight:bold;
}

.call{
  background:#0288D1;
  color:#fff;
}

.modal{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.6);
  align-items:center;
  justify-content:center;
  z-index:999;
}

.modal-box{
  background:#fff;
  padding:20px;
  border-radius:14px;
  width:90%;
  max-width:360px;
  text-align:center;
}
</style>
</head>

<body>

<div class="app">

<header>
  <img src="logo.png" alt="Torres Ice">
  <h1>Venta de Hielo Â· CopiapÃ³</h1>
  <small>ğŸ•˜ 09:00 a 22:00 Â· ğŸšš Delivery disponible</small>
</header>

<div class="card">

<h2>Bolsa de Hielo</h2>
<h3>Formato 1 Kg</h3>
<h3>$500</h3>

<div class="qty">
  <button onclick="changeQty(-1)">âˆ’</button>
  <input id="qty" type="number" value="1" readonly>
  <button onclick="changeQty(1)">+</button>
</div>

<p><strong>Zona de entrega</strong></p>
<select id="zone" onchange="updateAll()">
  <option value="retiro">Retira Cliente â€“ $0</option>
  <option value="centro">CopiapÃ³ Centro â€“ $1.000 (+10 bolsas $0)</option>
  <option value="alrededores">CopiapÃ³ Alrededores â€“ $1.200 (+10 bolsas $0)</option>
  <option value="paipote">Paipote Los Llanos â€“ $1.500 (+15 bolsas $0)</option>
  <option value="tierra">Tierra Amarilla â€“ $2.000 (+20 bolsas $0)</option>
</select>

<input id="customerName" placeholder="Nombre del Cliente" oninput="updateAll()">
<input id="phone" placeholder="Celular" oninput="updateAll()">
<input id="address" placeholder="DirecciÃ³n" oninput="updateAll()">
<input id="email" placeholder="E-mail" oninput="updateAll()">

<div class="summary">
  <p>Subtotal : $<span id="subtotal">500</span></p>
  <p>Delivery : $<span id="delivery">0</span></p>
  <p><strong>Total : $<span id="total">500</span></strong></p>
</div>

<button class="btn mp" onclick="pagarMP()">ğŸ’³ Mercado Pago</button>
<button class="btn tr" onclick="openTransfer()">ğŸ¦ Transferencia</button>

<a id="whatsapp" class="btn wa" target="_blank">
ğŸ“² WhatsApp - EnvÃ­o comprobante
</a>

<button class="btn call" onclick="location.href='tel:+56927731874'">
ğŸ“ Llamar Ahora
</button>

</div>
</div>

<div id="transfer" class="modal" style="display:none"
onclick="if(event.target.id==='transfer')closeTransfer()">
  <div class="modal-box">
    <h3>Datos para Transferir</h3>
    <p>Banco: Coopeuch</p>
    <p>Cuenta Vista: 251105735</p>
    <p>RUT: 12.218.473-0</p>
    <p>Oscar Torres LÃ³pez</p>
    <p>Email: hielo.torres.ice@gmail.com</p>
    <button class="btn tr" onclick="closeTransfer()">Cerrar</button>
  </div>
</div>

<script>
const price = 500;
let deferredPrompt;

/* ğŸŸ¦ AVISO INSTALAR APP */
window.addEventListener("beforeinstallprompt", (e) => {
  e.preventDefault();
  deferredPrompt = e;

  if (!localStorage.getItem("installDismissed")) {
    document.getElementById("installBanner").style.display = "block";
  }
});

/* âœ… CUANDO LA APP SE INSTALA */
window.addEventListener("appinstalled", () => {
  localStorage.setItem("installDismissed", "yes");
  document.getElementById("installBanner").style.display = "none";
});
  
function changeQty(v){
  const q = document.getElementById("qty");
  q.value = Math.max(1, parseInt(q.value) + v);
  updateAll();
}

function deliveryCost(q, z){
  if (z === "retiro") return 0;
  if (z === "centro") return q >= 10 ? 0 : 1000;
  if (z === "alrededores") return q >= 10 ? 0 : 1200;
  if (z === "paipote") return q >= 15 ? 0 : 1500;
  if (z === "tierra") return q >= 20 ? 0 : 2000;
  return 0;
}

function updateAll(){
  const q = parseInt(document.getElementById("qty").value, 10);
  const z = document.getElementById("zone").value;

  const sub = q * price;
  const del = deliveryCost(q,z);
  const tot = sub + del;

  document.getElementById("subtotal").innerText = sub;
  document.getElementById("delivery").innerText = del;
  document.getElementById("total").innerText = tot;

  const msg = `
Hola, quiero pedir hielo Torres Ice â„ï¸

Cantidad: ${q} bolsas
Subtotal: $${sub}
Delivery: $${del}
Total: $${tot}
`;

  document.getElementById("whatsapp").href =
    "https://wa.me/56927731874?text=" + encodeURIComponent(msg);
}

window.addEventListener("load", () => {
  document.getElementById("installBtn").onclick = async () => {
    if (!deferredPrompt) {
      alert("Usa el menÃº del navegador para instalar la App ğŸ“²");
      return;
    }
    deferredPrompt.prompt();
    await deferredPrompt.userChoice;
    deferredPrompt = null;
    document.getElementById("installBanner").style.display = "none";
  };

  document.getElementById("closeInstall").onclick = () => {
    document.getElementById("installBanner").style.display = "none";
    localStorage.setItem("installDismissed", "yes");
  };
});

/* ğŸŸ¦ SERVICE WORKER */
if ("serviceWorker" in navigator) {
  window.addEventListener("load", () => {
    navigator.serviceWorker.register("./sw.js");
  });
}

updateAll();
</script>

<div id="installBanner"
style="display:none; position:fixed; bottom:20px; left:50%; transform:translateX(-50%);
background:#0b5ed7; color:white; padding:15px 20px; border-radius:12px;
box-shadow:0 8px 20px rgba(0,0,0,.3);
max-width:90%; z-index:9999; text-align:center;">

  <strong>ğŸ“² Instala nuestra App</strong><br>
  Pide tu hielo mÃ¡s rÃ¡pido â„ï¸

  <div style="margin-top:10px;">
    <button id="installBtn"
      style="background:#ffc107; border:none; padding:8px 14px;
      border-radius:8px; font-weight:bold; cursor:pointer;">
      Instalar App
    </button>

    <button id="closeInstall"
      style="margin-left:10px; background:transparent; color:white;
      border:none; font-size:18px; cursor:pointer;">
      âœ•
    </button>
  </div>
</div>

</body>

</div>
  
</html>
