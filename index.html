<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Torres Ice - Venta de Hielo</title>

  <!-- PWA -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#0bbcd6">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
</head>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0bbcd6">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  
<style>
* { box-sizing:border-box; margin:0; padding:0; }

<script>
if ('serviceWorker' in navigator) {
  window.addEventListener('load', function () {
    navigator.serviceWorker.register('sw.js')
      .then(() => console.log('Service Worker registrado'))
      .catch(err => console.error('Error SW:', err));
  });
}
</script>

body {
  font-family: Arial, sans-serif;
  background: url('fondo-hielo.png') no-repeat center center fixed;
  background-size: cover;
}

.main-container {
  min-height: 100vh;
  backdrop-filter: blur(3px);
  background: rgba(255,255,255,0.15);
}

/* HEADER */
header {
  text-align:center;
  padding:15px;
  background: rgba(255,255,255,0.25);
}
header img { height:60px; margin-bottom:5px; }
header h1 { font-size:1.4rem; }

/* INFO */
.info {
  text-align:center;
  font-size:0.9rem;
  padding:6px;
  background: rgba(224,247,255,0.25);
}

/* CARD */
.card {
  max-width:400px;
  margin:15px auto;
  padding:15px;
  border-radius:15px;
  background: rgba(255,255,255,0.25);
  backdrop-filter: blur(3px);
  text-align:center;
}

/* CANTIDAD */
.quantity {
  display:flex;
  justify-content:center;
  align-items:center;
  margin:10px 0;
}
.quantity button {
  width:40px;
  height:40px;
  border:none;
  border-radius:50%;
  background:#ff6b00;
  color:#fff;
  font-size:1.3rem;
}
.quantity input {
  width:70px;
  text-align:center;
  font-size:1.2rem;
  margin:0 8px;
}

/* INPUTS */
input, select {
  width:100%;
  padding:10px;
  margin:6px 0;
  border-radius:10px;
  border:1px solid #ccc;
}

/* BOTONES */
.btn {
  width:100%;
  padding:14px;
  margin:6px 0;
  font-size:1.05rem;
  border:none;
  border-radius:14px;
  cursor:pointer;
}
.btn-mp { background:#ff6b00; color:#fff; }
.btn-tr { background:#0077b6; color:#fff; }
.btn-wa {
  background:#25D366;
  color:#fff;
  display:flex;
  justify-content:center;
  align-items:center;
  pointer-events:none;
  opacity:0.5;
}
.btn-call { background:#005f8a; color:#fff; }

/* MODAL */
.modal {
  display:none;
  position:fixed;
  top:0; left:0;
  width:100%; height:100%;
  background:rgba(0,0,0,0.5);
  justify-content:center;
  align-items:center;
}
.modal-content {
  background:#fff;
  padding:20px;
  border-radius:15px;
  max-width:340px;
  width:90%;
  text-align:center;
}
.close {
  position:absolute;
  top:10px;
  right:15px;
  font-size:26px;
  cursor:pointer;
}
</style>
</head>

<body>
<div class="main-container">

<header>
  <img src="logo_transparente.png">
  <h1>Torres Ice - Venta de Hielo</h1>
</header>

<div class="info">
  üïò 09:00 a 22:00 ¬∑ üöö Delivery ¬∑ ‚úâÔ∏è hielo.torres.ice@gmail.com
</div>

<div class="card">
  <h2>Bolsa de Hielo</h2>
  <p>1 Kg ¬∑ $500</p>

  <div class="quantity">
    <button onclick="changeQty(-1)">‚àí</button>
    <input type="number" id="qty" value="1" min="1" onchange="updateTotal()">
    <button onclick="changeQty(1)">+</button>
  </div>

  <p>Subtotal: $<span id="subtotal">500</span></p>
  <p>Delivery: $<span id="delivery">0</span></p>
  <h3>Total: $<span id="total">500</span></h3>

  <select id="zone" onchange="updateTotal()">
    <option data-cost="0" data-free="0">Retira Cliente $0</option>
    <option data-cost="1000" data-free="10">Copiap√≥ Centro $1000</option>
    <option data-cost="1200" data-free="10">Copiap√≥ Alto $1200</option>
    <option data-cost="1500" data-free="10">Paipote $1500</option>
    <option data-cost="2000" data-free="15">T. Amarilla $2000</option>
  </select>

  <input id="name" placeholder="Cliente" oninput="updateWhatsApp()">
  <input id="phone" placeholder="Celular" oninput="updateWhatsApp()">
  <input id="address" placeholder="Direcci√≥n" oninput="updateWhatsApp()">
  <input id="email" placeholder="E-mail" oninput="updateWhatsApp()">

  <button class="btn btn-mp" onclick="mercadoPago()">üí≥ Mercado Pago</button>
  <button class="btn btn-tr" onclick="openTransfer()">üè¶ Transferencia</button>

  <a id="wa" class="btn btn-wa">üì≤ WhatsApp - Env√≠o comprobante</a>
  <a href="tel:+56927731874" class="btn btn-call">üìû Llamar Ahora</a>
</div>

<!-- MODAL TRANSFERENCIA -->
<div id="modalTransfer" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeTransfer()">√ó</span>
    <h3>Datos Transferencia</h3>
    Banco: Coopeuch<br>
    Cuenta Vista: 251105735<br>
    RUT: 12.218.473-0<br>
    Oscar Torres L√≥pez<br>
    Email: hielo.torres.ice@gmail.com
  </div>
</div>

<!-- MODAL POST PAGO -->
<div id="postPago" class="modal">
  <div class="modal-content">
    <h3>‚úÖ Pago iniciado</h3>
    <p>Env√≠a tu comprobante por WhatsApp para coordinar entrega.</p>
    <button class="btn btn-wa" onclick="closePostPago()">üì≤ Enviar WhatsApp</button>
  </div>
</div>

<script>
const price = 500;

function changeQty(n){
  let q = parseInt(qty.value) + n;
  if(q<1) q=1;
  qty.value=q;
  updateTotal();
}

function updateTotal(){
  const q = parseInt(qty.value);
  const z = zone.options[zone.selectedIndex];
  let d = parseInt(z.dataset.cost);
  if(q >= z.dataset.free && z.dataset.free > 0) d = 0;

  subtotal.textContent = q*price;
  delivery.textContent = d;
  total.textContent = q*price + d;
  updateWhatsApp();
}

function enableWA(){
  wa.style.pointerEvents="auto";
  wa.style.opacity="1";
}

function updateWhatsApp(){
  const msg =
`Hola, quiero pedir hielo Torres Ice ‚ùÑÔ∏è

Cantidad: ${qty.value} bolsas
Subtotal: $${subtotal.textContent}
Delivery: $${delivery.textContent}
Total: $${total.textContent}

Cliente: ${name.value||'-'}
Celular: ${phone.value||'-'}
Direcci√≥n: ${address.value||'-'}
E-mail: ${email.value||'-'}`;
  wa.href="https://wa.me/56927731874?text="+encodeURIComponent(msg);
}

function mercadoPago(){
  enableWA();
  window.open("https://link.mercadopago.cl/torresice","_blank");
  setTimeout(()=>postPago.style.display="flex",800);
}

function openTransfer(){ enableWA(); modalTransfer.style.display="flex"; }
function closeTransfer(){ modalTransfer.style.display="none"; }
function closePostPago(){ postPago.style.display="none"; }

updateTotal();

function closeTransferencia() {
  const modal = document.getElementById("transferenciaModal");
  modal.style.display = "none";
  document.body.style.overflow = "auto";
}
  function pagarMercadoPago() {
  // Cerrar cualquier modal activo
  const modal = document.getElementById("transferenciaModal");
  if (modal) modal.style.display = "none";

  document.body.style.overflow = "auto";

  // Abrir Mercado Pago
  window.open(
    "https://link.mercadopago.cl/torresice",
    "_blank"
  );
}

</script>

</div>
</body>
</html>
